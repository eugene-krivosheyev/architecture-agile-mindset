Иди туда, не знаю куда
======================
Существует ряд связанных фундаментальных инженерных проблем, три основных из которых мы тут обсуждаем.
Это 
- [x] _Противоречивость требований_, 
- [ ] Внутренняя неопределенность – неопределенность _реализации_, 
- [ ] Внешняя неопределенность – неопределенность _требований_. 

Они сильно переплетаются между собой и первую из них мы рассмотрели, обсуждая противоречивость требований и дилеммы (trade-offs).
Далее рассмотрим вторую из них – _Неопределенность реализации_.

Проблема _внутренней_ неопределенности (решения, реализации)
--------------------------------------
Хорошо, когда мы строим идейно-близкую нам систему и все знакомо и понятно – у нас был похожий опыт. 
Но как поступать архитектору, когда у него нет заготовленных знаний по решению нужной задачи? То есть нет готового ответа на вопрос _как делать?_

Обычно мы не знаем точно, как строить систему, если:

1. Не знаем готовые приемы (паттерны)
1. Знаем паттерны, но не умеем их сочетать в решения
1. Знаем паттерны и умеем их комбинировать, но порождаются сложные побочные эффекты и дилеммы, которые не умеем решать
1. Задача новая и пока нет готовых паттернов решения – надо уметь изобретать новые решения

Идея того, что проблемы различаются по степени нашего опыта их решения – не нова. Существуют обобщенная модель работы с неопределенностью, которая дает рекомендации, как решать проблемы исходя из степени накопленного опыта и наших возможностей. Это модель Cynefin[@cynefin] и мы как индустрия просто переизобрели ее, дав свои названия разным стратегиям борьбы с неопределенностью решения.

Как оценить неопределенность решения
------------------------------------
Есть простые способы оценки степени нашей неуверенности в том, как делать.

1. Индивидуальный экспресс-метод: _маркерный вопрос_ "Вот я укрупненно прикинул решение. Готов ли я поставить свою квартиру на то, что это решение заработает, как надо, и даст нужные характеристики NFR?". Честный ответ себе на этот вопрос показывает степень неуверенности, неопределенности решения. Тут самое главное – честно это принять и применить способы борьбы с неопределенностью, а не заниматься самовнушением, что решение понятное.
1. Групповой экспресс-метод: _разброс оценок_. Когда команда оценивает трудоемкость задачи или уже непосредственно выбирает решение, стоит обращать внимание на то, насколько разошлись оценки участников команды. Это может свидетельствовать как раз о том, что участники не уверены, как нужно реализовывать. Носитель архитектурной функции должен убедиться, в чем причина разброса оценок и если это действительно неопределенность решения, то не игнорировать эти риски, а предложить способ борьбы с неопределенностью.  

Справочник принципов разрешения внутренней неопределенности (решения, реализации)
-----------------------------------------------------------
_Остановись на секунду_ и скажи свое мнение –
что делать в ситуации неопределенности решения, когда прошлого опыта не хватает для решения задачи? Когда мы не знаем наверняка, _как делать_?

_Давай для примера представим_,
что нам нужно запилить табуретку. Но приблизим условия к более реальным. Инструменты по дереву ты видел последний раз в школе, а современные инструменты и материалы не видел даже на картинках. А табурет не ждет! Как стоит построить работу?

| Ситуация с задачей                                                           | Что подсказывает здравый смысл                                                                                                                                                                                                                                    | Паттерн на языке архитекторов                                                                                                                                                             |
|------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Решаем такие задачи каждый день: однообразные задачи, повторяющие предыдущие | Делать как обычно (по готовому дизайну/архитектуре) – правильные решения уже готовы. Надо просто не накосячить в исполнении («работает – не трогай!»). _«У нас уже есть какая-то тактика и мы ее придерживаемся»_                                                 | Существует явная *Default Architecture* с заданными Patterns, которой жестко следуем                                                                                                      | 
| Задачи не имеют разнообразия и сводятся к набору предыдущих                  | Провести глубокое проектирование: принять все решения заранее – от самых главных до мельчайших. На каждом шаге стараться решения сводить к проверенным (паттернам). _«Семь раз все отмерь – один раз отрежь»_                                                     | Проектируем заранее по *BDUF*: Big Design Up Front                                                                                                                                        |                                                                                                                   
| Задачи имеют разнообразие, но зачастую сводятся к набору предыдущих          | Провести проектирование только архитектуры: принять только ключевые решения. Менее значимые решения по дизайну или отложить, или отдать конкретному исполнителю этого элемента системы. _«С фигней исполнитель разберется потом»_                                 | Проектируем по модели *Lean Software Development*: Up Front Architecture + Emergent micro-design                                                                                          |                                                                                                                   
| Задачи имеют крайнее разнообразие, не сводятся к предыдущим                  | Пытаться заранее запроектировать все не получится – наш опыт не может подсказать, где риски. Заранее знаний нет, поэтому будем их получать в процессе – ставить инженерные эксперименты и успешные результаты включать в архитектурные решения. _«Разведка боем»_ | Emergent Architecture, Agile Architecture, Инженерные гипотезы архитектуры, Архитектурные прототипы. Так же см. [закон Галла](https://habr.com/ru/companies/itglobalcom/articles/453982/) |     

Одновременно с этими стратегиями мы будем стараться по возможности использовать хак – "покупка экспертизы". Если для нас (лично или командой) задача несет риски неопределенности и не знаем точно, как делать, это не значит, что такого опыта нет у других. И максимально по возможности мы будем стараться повысить определенность решения банально покупая экспертизу. Где можно получить экспертизу, снизив класс сложности задачи для нас:

1. В рамках команды – обратиться к teammate
1. В рамках компании – найти в компании коллег с опытом и обратиться к ним
1. Во внешней среде – по знакомым, соцсетям, профессиональным сообществам
1. На внешнем рынке – обратиться к специализированным консультантам (их работа как раз продавать редкую экспертизу)

_Что это значит конкретно для тебя?_
Необходимо знать не только готовые архитектурные решения (паттерны), но и уметь искать экспертизу вовне и помогать команде проектировать в условиях новых незнакомых задач:

1. Понимать ключевые принципы построения it-систем (справочник принципов) – универсальных архитектурных ограничений, работающих независимо от новизны задачи.
1. В случае, когда текущей экспертизы команды не хватает, участвовать в генерации и проверке инженерных гипотез (архитектурных прототипов). Это отдельный навык, требующий проработки – быстро формулировать инженерные гипотезы, эффективно проверять и документировать их, "продавать" их коллегам.  
1. Иметь нетворк, уметь искать нужную экспертизу в компании и вовне, оценивать внешнюю экспертизу, адресовать связанные риски.  


Практики Design Doc и ADR
-------------------------
Как мы увидели, не все решения сводятся к прямолинейному применению известных паттернов. Мы можем потратить достаточно сил и времени на синтез нужного решения – не очень много в случае невысоких рисков неопределенности или попасть на полноценный большой проект проверки инженерной гипотезы.
Поэтому возникает здравая идея документировать свои архитектурные решения. Эта практика называется Документирование Архитектуры (Architecture Design Doc) и довольно распространена.  

Но затраченные силы подсказывают, что стоит документировать не только само решение, но предпосылки, проработанные альтернативы, путь к этому решению.
Это позволит в дальнейшем не допустить ошибок развития системы и будет проще принимать схожие решения.
Практика, которую стоить внедрить в процесс разработки, называется ADR (Architecture Decision Record).

Варианты шаблонов и подходящие инструменты можно выбрать в [руководстве по ADR от Amazon](https://docs.aws.amazon.com/prescriptive-guidance/latest/architectural-decision-records/adr-process.html#) или [на страничке сообщества ADR](https://adr.github.io).  
