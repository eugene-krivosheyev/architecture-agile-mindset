Обоснуй меня полностью
======================

Важность требований
-------------------
_Остановись на секунду_ и скажи свое мнение – как мы обосновываем наши решения при проектировании систем?

_Например_, мы проектируем бизнес по общепиту (кафе). Предстоит принять множество важных, архитектурных решений в различного характера (PoV): разбиение сотрудников на функциональные отделы, процессы взаимодействия между ними, соответственно этому запроектировать помещение, и т.д.
Чем мы будем руководствоваться при принятии этих решений?

Ответ – _требования_ к системе. Это список ожиданий со стороны ключевых стейкхолдеров по поводу функционирования будущей системы и ее свойств. 

Это требования к системе в идеале должны укладываться в схему INVEST:
- Independent: независимые, а не "ну, вся система в целом должна работать типа хорошо"
- Negotiable: обсуждаемые, а не "отлитые в граните раз и навсегда"
- Valuable: нужные, в не "ну на всякий случай – когда-нибудь может пригодиться" 
- Estimable: возможно оценить и отслеживать выполнение по времени, а не "фиг знает, сколько займет – не будем об этом думать"
- Small: если можно декомпозировать требование с сохранением нужности кусочков – стоит декомпозировать и тем самым быстрее давать ценность пользователям, а не "ну будет через пару лет, зато все сразу"
- Testable: четко и однозначно проверяемые, а не "ну кажется, что готово"

| Требования к кафе                                                           | Характер требований                                                                                                                       | Пример уточнения требования, возможные метрики                                                                      |
|-----------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------|
| Посетитель может заказать порционные судачки a la натюрель                  | Желаемое поведение системы для пользователя, _внешний функционал_ системы                                                                 | Спецификация (рецепт) блюда                                                                                         | 
| Посетитель желает заказ "аж бегом"                                          | Свойство системы для пользователя, внешняя характеристика, _атрибут качества_ Производительность, KPI системы по времени обработки заказа | При загрузке в 10 одновременных заказов система должна с вероятностью 95% обработать заказ не более, чем за 5 минут |
| Сотрудники хотят справедливую систему распределения чаевых                  | Желаемое поведение системы для сотрудников, _внутренний функционал_ системы                                                               | Бизнес-правила распределения чаевых, автоматизация перечисления на карты сотрудников                                |
| Сотрудники хотят тратить как можно меньше сил и времени на уборку помещений | Свойство системы для сотрудников, внутренняя характеристика, _атрибут качества_ Убираемость                                               | При загрузке в 10 работающих столиков сотрудник с вероятностью 95% должен тратить не более 5 минут на уборку кухни  |

_Что это значит конкретно для тебя?_

1. Мы должны принимать решения (проектировать систему) так, чтобы удовлетворить поставленным требованиям.
1. Не бывает хорошего или плохого решения – одно и то же инженерное решение может удовлетворять одним требованиям, и не подходить для других.

_Что дальше?_
Задумайся, как обычный пользователь информационных систем – как бы сформулировал типовые требования? Как бы сгруппировал их? И, с другой стороны, как участник разработки – что ты ждешь от системы для себя?


Таксономия требований к целевой информационной системе
------------------------------------------------------
_Остановись на секунду_ и скажи свое мнение – какие требования можно выделить для ИС? Как их можно сгруппировать?

Ниже представлена одна из популярных таксономий (классификаций) требований. Это далеко не единственная классификация, но она проста и достаточна для дальнейших обсуждений.

|                                  | *Внешние*, для пользователей                                                                                   | *Внутренние*, для команды                                                                                                                                                               |
|----------------------------------|----------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| *Функциональные*, FR ("что?")    | Сценарии взаимодействия пользователя с системой. Форматы описания: UseCases, UserStories, JobStories и другие. | Сценарии взаимодействия разработчиков, администраторов, DevOps-инженеров, инженеров линий поддержки с системой. Форматы описания: System/Infrastructure UserStories и другие.           |
| *Нефункциональные*, NFR ("как?") | Usability, Performance, Availability, Reliability/Fail-over, Scalability, Security, Consistency и др.          | Supportability (Readability, Extensibility, Testability), Maintainability (Deployability, Manageability, Observability, Recoverability), Partitioning Tolerance, Interoperability и др. |

Эта классификация достаточно условная, границы размыты – мы можем при желании отнести часть требований к другой группе. Например, считать NFR Performance (Производительность) частью описания FR в формате User Story – перенести метрики производительности в описания пользовательских сценариев.
Тогда в чем польза этой классификации? 
Отнесение требований к FR или, напротив, к NFR дает нам готовые форматы и шаблоны описания FR и готовые справочники NFR c метриками.
А отнесение требований к внутренним или внешним дает нам понимание стейкхолдеров, с которыми нужно обсуждать требования и согласовывать решения: это Пользователи, Заказчики, Продакты или участники нашей команды разработки.

_Что это значит конкретно для тебя?_

1. Требований к системе много, их нужно анализировать и уточнять.
1. Нужно понимать, к кому идти за требованиями и с кем согласовывать решения.
1. Нужно понимать типовые форматы записи FR и NFR и их метрики.
1. Без анализа, доуточнения и фиксации требований мы не сможем принимать инженерные решения при проектировании целевой системы.  

Более подробно таксономия требований развернута в книге Разработка требований к программному обеспечению[@vigers].

_Что дальше?_
Задумайся, как можно было бы описывать функциональные требования (FR)? Какой мог бы быть шаблон?


Внешние функциональные требования: внешние FR
---------------------------------
_Остановись на секунду_ и скажи свое мнение – что должны отражать функциональные требования к системе?

При описании функциональных требований к целевой системе важно описать _сценарии взаимодействия_ пользователей и системы.
Поэтому обычно форматы описания включают в себя действия со стороны пользователя и описание нужной реакции системы – _диалог_ пользователя с системой.

Один из самых популярных форматов описания FR – _User Story_ (US)[@patton]. Но это не только шаблон описания сценария работы пользователя с системой, но и подход к эволюции – последовательному уточнению по мере реализации этого требования.
Изначально User Story вводится командой или Product Owner в список работ (backlog) просто в виде краткого названия. Например, "Простой каталог товаров".
Далее по мере реализации предыдущих задач из беклога команда приближается к этому требованию и доуточняет его – раскрывает ожидания пользователя от системы: 
> Я, как [роль],
> хочу [функционал системы],
> чтобы [ценность для меня] 

Например,
```
User Story Простой каталог товаров:
я, как незарегистрированный пользователь, хочу увидеть каталог товаров, чтобы сравнить цены и купить по оптимальной цене.  

User Story Каталог с пользовательской ценой:
я, как зарегистрированный пользователь, хочу увидеть каталог товаров с ценами с учетом моей персональной скидки, чтобы сравнить цены и купить по оптимальной цене.  
```
Но это тоже пока не полноценные сценарии. Они появляются, когда команда непосредственно берет это требование в реализацию. Команде нужно предельно четко понимать, как реализовать этот функционал.
И тогда мы доуточняем это требование – добавляем для User Story _приемочные сценарии/тесты_:

```
User Story "Простой каталог товаров":
Я, как незарегистрированный пользователь, хочу увидеть каталог товаров, чтобы сравнить цены и купить по оптимальной цене.
 
Сценарий штатный "товары есть":
Допустим, пользователь не зарегистрирован 
И товаров в каталоге ≤ 20
Когда пользователь запрашивает каталог товаров
Тогда пользователь видит таблицу с товарами: название, производитель, цена
И для каждого товара есть возможность отложить его в сравнение

Сценарий штатный "товары есть и их много":
Допустим, пользователь не зарегистрирован 
И товаров в каталоге > 20
Когда пользователь запрашивает каталог товаров
Тогда пользователь видит таблицу с товарами: "название, производитель, цена"
И для каждого товара есть возможность отложить его в сравнение
И товаров в таблице 20
И есть возможность запросить следующие 20 товаров 

Сценарий штатный "товаров нет":
Допустим, пользователь не зарегистрирован 
И товаров в каталоге нет
Когда пользователь запрашивает каталог товаров
Тогда он видит сообщение о пустом каталоге
И предложение подписаться на обновления каталога

Сценарий нештатный "нет доступа к хранилищу товаров":
Допустим, пользователь не зарегистрирован 
И товары в каталоге есть
Но нет доступа к хранилищу товаров
Когда пользователь запрашивает каталог товаров
Тогда пользователь видит сообщение "Проблема на нашей стороне, мы уже исправляем"
И администраторы получают извещение об ошибке у пользователя с описанием
```
Безусловно, формат User Story далеко не единственный для описания FR, но у всех этих форматов много общего.

_Что это значит конкретно для тебя?_

1. Требования последовательно доуточняются по мере их проработки: сначала в беклоге просто название User Story, потом добавляется тело User Story, потом приемочные сценарии. На каждом уточнении ты должен участвовать как носитель архитектурной функции, так как это уточнение может повлечь изменение ключевых (архитектурных) решений.
1. Очень важно, что тело US включает в себя _ценность_ для пользователя. Когда мы проектируем и реализуем функционал, понимание того, _зачем_ это пользователям, позволяет принимать более подходящие инженерные решения. Это и свобода решений, и одновременно ответственность. И тут ты должен участвовать со своей оценкой, повлияет ли инженерное решение на архитектуру. 
1. Для более частых и ритмичных поставок мы можем разбить US по сценариям: реализовать не сразу все сценарии US, а по очереди. Для этого на уровне архитектуры ты должен обеспечить возможность инкрементальных поставок – маленьких, но завершенных доработок.  
1. Некоторые US несут архитектурные риски: при их реализации нужно будет существенно поменять систему. Чтобы узнавать об этом пораньше, команда не фокусируется только ближайших задачах из беклога, но периодически просматривает его целиком. Это называется backlog grooming – "причесывание" беклога. Мы выкидываем неактуальные требования и ищем те, которые могут поменять архитектуру. 

_Что дальше?_
Как у _пользователя_ информационных систем, какие еще у тебя есть ожидания от системы, кроме того, _что_ она должна делать?


Внешние атрибуты качества: внешние NFR
-------------------------
_Остановись на секунду_ и скажи свое мнение – _как_ система должна выполнять свой функционал?

Давай подробнее разберемся с типовыми нефункциональными требованиями со стороны пользователя (внешние NFR). Ниже табличка с описанием требований, но это далеко не полная и единственная модель таких NFR-требований. Множество книг описывают их, зачастую немного по-разному формулируя. Поэтому главное – договориться в команде о формулировках и метриках.
Это крайне важно, потому что архитектура очень чувствительна к NFR: небольшое изменение требований может повлечь необходимость очень масштабных (архитектурных) изменений.

| Внешние NFR                                 | Штоэта?                                                                                                                                                                                                                                                                            | Примеры с метриками                                                                                                                                                                                                                                                             | 
|---------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Correctness                                 | Корректность системы: соответствие поставленным требованиям. Настолько очевидная характеристика, что подразумевается по умолчанию.                                                                                                                                                 | Плотность дефектов (баг, несоответствие требованиям). "5 багов на 1 KSLoC (тысячу значимых строк программного кода)"                                                                                                                                                            |
| Usability (part of the User Experience, UX) | Эргономика как часть Пользовательского опыта. Насколько эффективно и комфортно пользователь решает свои задачи.                                                                                                                                                                    | Количество ошибок, лишних действий. Необходимость лезть в документацию. Общие ощущения удовлетворенности.                                                                                                                                                                       |
| Performance:                                | Производительность системы.                                                                                                                                                                                                                                                        |                                                                                                                                                                                                                                                                                 |
| - Responsiveness                            | Время отклика. Время, за котрое пользователь понимает, что система отреагировала на его запрос. Отреагировала – не значит, что ответила с результатом.                                                                                                                             | "Пользователь понимает, что его запрос принят (информационное сообщение или состояние кнопки в UI) не более чем за 5 мс."                                                                                                                                                       |
| - Response time                             | Время ответа. Время, за которая система отвечает пользователю с результатом его запроса.                                                                                                                                                                                           | "В штатном режиме работы при нагрузке 100 запросов в секунду система должна отвечать в 95% случаев не дольше, чем за 10 мс."                                                                                                                                                    |
| - Throughput                                | Пропускная способность. Это обрабатываемое количество операций (например, запросов к системе) в секунду.                                                                                                                                                                           | "В штатном режиме работы система должна проводить не менее 50 операций по печати отчета в час."                                                                                                                                                                                 | 
| Reliability/Fail-over:                      | Надежность/отказоустойчивость. Частота предусмотренных отказов и непредусмотренных сбоев, приводящих к необработке пользовательского запроса.                                                                                                                                      | Время наработки на отказ (часов), Плотность аварий на эксплуатационной среде (раз в год).                                                                                                                                                                                       |
| - Partitioning Tolerance                    | Способность системы продолжать работать даже в случае поломки сети между серверами (когда наше множество серверов _разделяется_ - partitioning). Один из факторов свойства Надежности.                                                                                             | "разделяемая" система vs "неразделяемая".                                                                                                                                                                                                                                       |
| Availability                                | Доступность. % времени, когда система работает, а не простаивает. А простаивать она может не только по причине сбоев и отказов, но и по причине эксплуатационных окон или перегрузки.                                                                                              | Доступность системы не менее 99,99% ("четыре девятки" ~ 53 минуты в год).                                                                                                                                                                                                       | 
| Scalability                                 | Масштабируемость. Мера сложности адаптации системы под бо́льшую нагрузку при необходимости.                                                                                                                                                                                        | "Сколько будет стоить адаптировать систему, если количество запросов в секунду вырастет в два раза?" Обычно это требует глубокого анализа, поэтому в общении для упрощения используются качественные оценки: "система масштабируется легко" vs "система масштабируется тяжело". |                          
| Security                                    | Информационная Безопасность. Стоимость по основным векторам атак, приводящим к нарушению конфиденциальности, целостности и доступности данных. Это не только несанкционированный доступ к данным (НСД), но и атаки на отказ инфраструктуры и приложений (DoS), и др. вектора атак. | Обычно стоимость требует глубокого анализа, поэтому в общении для упрощения используются качественные оценки: "безопасно" (рисками пренебрегаем) vs "дырка" (риски существенны, возможная стоимость атак оправдана).                                                            |                             
| Consistency                                 | "Правильность" данных: Корректность данных (соответствие бизнес-правилам предметной области), Целостность (соответствие данных в разных частях системы) и Актуальность (соответствие данных в системе реальному миру).                                                             | Обычно оцениваются качественно. Корректность: данные "корректны" vs "поломались". Целостность: данные "целостны" vs "разъехались". Актуальность: данные "актуальны" vs "протухли".                                                                                              |                          

Может показаться, что это большой список атрибутов качества и какой-то абстрактный – можно пропустить мимо ушей и тебя это не коснется. 
Это совсем не так – это самые ключевые NFR, в целом индустрия насчитывает их более двух сотен. 
И особая важность именно их в том, что инженеры при проектировании тратят больше всего времени и сил на их реализацию. 
Так что ты постоянно будешь возвращаться именно к этим характеристикам системы, пытаясь их обеспечить для своих систем.

_Что это значит конкретно для тебя?_

1. Внешние NFR – характеристики системы, которые волнуют Пользователей, Заказчиков, Спонсоров. Поэтому тебе нужно будет очень аккуратно выявлять и записывать их.
1. Архитектура целевой системы очень чувствительна к внешним NFR – небольшое изменение одного их этих требований может привести к существенной переработке всей системы.

Более подробно погрузиться в список популярных нефункциональных требований можно, начав с WikiPedia[@nfr].

_Что дальше?_
Как ты думаешь, а функциональные требования (FR) могут быть только для конечных пользователей?  


Внутренние функциональные требования: внутренние FR
------------------------------------
_Остановись на секунду_ и скажи свое мнение – кто еще, кроме конечных пользователей, может инициировать поведение системы? Для кого еще мы можем писать User Story, кроме пользователей?

Часть функционала системы нужна не конечным пользователям, а участникам команды и самой системе и подсистемам. 
Тогда это получаются уже не пользовательские сценарии (_User_ Story), а _Technical_ Story (Infrastructure Story).

| Стейкхолдер                  | Примеры Technical Story                                                                                                                                                                                                                                                          |
|------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Участники команды разработки | "Метрики: я, как Администратор (Ops) или DevOps-инженер, хочу наблюдать системные метрики, чтобы вовремя диагностировать проблемы." "Внутренняя админка: я, как Оператор первой линии поддержки, хочу видеть всю информацию о пользователе, чтобы быстрее оказывать ему помощь." |
| Система и подсистемы         | "Авто-удаление брошенных корзин: я, как система, должна периодически удалять информацию о брошенных корзинах, чтобы освободить хранилище и ускорить запросы."                                                                                                                    |

Такие технические истории, где функционал реализуется не для конечного пользователя – спорная идея.
Индустрия не пришла к однозначному выводу, но общая рекомендация – избегать подобных требований к системе.
Проблема в том, что когда стейкхолдером становится не конечный пользователь, vs можем очень легко потерять нить, зачем нужен функционал, и начать неоправданно переусложнять систему. 
Поэтому можно избегать подобных требований, формулируя их по-другому:
- В виде _атрибутов качества_, NFR. Например, US "Метрики" -> NFR "Наблюдаемость", US "Авто-удаление брошенных корзин" -> NFR "Производительность".
- Все-таки в виде _пользовательских_ историй. Например, US "Авто-удаление брошенных корзин" -> подсценарий US "Просмотр корзины" для случая, когда пользователь возвращается к корзине после долгого отсутствия и не находит эту корзину.

_Что это значит конкретно для тебя?_

1. Существует "скрытый" функционал системы, неявный для конечных пользователей – который сложно привязать к ценности для пользователей.
1. Очень важно не забыть про такие внутренние функциональные требования – учитывать их в бюджете, плане работ и архитектуре системы.
1. Старайтесь все-таки отходить от псевдо-стейкхолдера "Система или подсистема" – переформулируйте такие системные истории или в явные свойства системы (NFR), или находите связь с ценностью для пользователя и формулируйте в виде пользовательских историй.    

_Что дальше?_
Как у разработчика, будут ли у тебя свои ожидания от _свойств_ системы?


Внутренние атрибуты качества: внутренние NFR
----------------------------
_Остановись на секунду_ и скажи свое мнение – что ты как _участник команды разработки_ ждешь от системы? Каких свойств?

Другие стейкхолдеры кроме пользователей, особенно участники команды разработки, так же очень активно взаимодействуют с системой. Ты можешь проводить с системой больше времени, чем конечный пользователь.
Поэтому ты и другие участники так же имеют полное право предъявлять ожидания к системе. 
Это _внутренние NFR_. Часто так же их называют _модель внутреннего качества_ или _Фитнес-функция_. Что такое качественно сделанная система? 

| Внутренние NFR   | Штоэта?                                                                                                                                                                                              | Примеры с метриками. Обычно стоимость требует глубокого анализа, поэтому чаще в общении оценивается качественно:                                                                                        | 
|------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Supportability:  | Стоимость изменения/расширения функционала системы.                                                                                                                                                  | "поддерживамая" система vs "тяжело поддерживаемая".                                                                                                                                                     |
| - Readability    | Читабельность/понятность. Для внесения изменений нам сначала нужно быстро и четко найти, где менять – стоимость локализации изменений (где?)                                                         | "архитектура понятная – быстро и без ошибок понимаем" vs "WTF/сек".                                                                                                                                     |
| - Extensibility  | Расширяемость, гибкость.  Стоимость внесения изменений.                                                                                                                                              | "архитектура гибкая - быстро и без ошибок меняем" vs "архитектура вязкая" (для изменения нужно провести очень много действий, трудоемко) и "архитектура хрупкая" (при изменениях постоянно все ломаем). |
| - Testability    | Тестопригодность. После внесения изменений надо убедиться, что мы не накосячили при изменениях – стоимость ручного тестирования (минимум) или покрытия автотестами (штатный рекомендованный вариант) | "архитектура тестопригодная - быстро и дешево можно покрыть тестами" vs "архитектура нетестопригодная".                                                                                                 |
| Maintainability: | Стоимость операционного обслуживания системы в эксплуатации.                                                                                                                                         | "сопровождаемая" система vs "тяжело сопровождаемая".                                                                                                                                                    |                                                                                                                                                          
| - Portability    | Стоимость переноса на другое окружение с другим инфраструктурным стеком. Как при разработке и развертывании, так в эксплуатации.                                                                     | "переносимая" система vs "тяжело переносимая".                                                                                                                                                          |
| - Deployability  | Стоимость развертывания при обновлениях.                                                                                                                                                             | "развертываемая" система vs "тяжело развертываемая".                                                                                                                                                    |
| - Manageability  | Стоимость управления при внешних изменениях (конфигурируемость, переносимость между узлами, выводимость из эксплуатации, и тд).                                                                      | "управляемая" система vs "таяжело управляемая".                                                                                                                                                         |
| - Observability  | Стоимость наблюдения, диагностики и решения проблем (мониторинг, журналирование, трейсинг).                                                                                                          | "наблюдаемая, прозрачная" система vs "непрозрачная".                                                                                                                                                    |
| - Recoverability | Стоимость и время восстановления после инцидентов.                                                                                                                                                   | "поднимаемая" система vs "лежачая".                                                                                                                                                                     |

Да, граница между этими внутренними атрибутами качества и внешними довольно расплывчатая – можно попробовать выразить внутренние NFR в виде внешних, несущих ценность непосредственно пользователям.
Но эта модель внутренних NFR очень старая, унаследованная – поэтому к ней банально все привыкли.

_Что это значит конкретно для тебя?_
1. Fitness-функция нужна не конечным пользователям, а внутренним стейкхолдерам – Заказчику, Продакту, Команде.
1. Fitness-функция в целом определяет бизнес-гибкость нашей компании – насколько быстро, дешево и без ошибок Команда может впиливать изменения. А сегодня это ключевое свойство выживания и успеха бизнеса.  
1. Тебе как носителю архитектурной функции необходимо реализовать эти свойства в архитектуре системы. Запроектировать архитектуру с учетом этих внутренних свойств гораздо сложнее, чем без них. Но необходимо. 

_Что дальше?_
Как ты думаешь, что еще может определять твои инженерные решения по архитектуре целевой системы?


Внутренние ограничения: архитектурные ограничения корп it-ландшафта
----------------------
_Остановись на секунду_ и скажи свое мнение – что еще, кроме четырех видов требований, повлияет и ограничит твои архитектурные решения?

Кроме требований к системе, архитектурные решения так же определяются _архитектурными ограничениями и рекомендациями_ нашей компании.
Чаще всего это касается выбора готовых it-компонентов (операционных систем для переносимости, хранилищ данных, серверов приложений, языков программирования и библиотек). Иногда сборник таких рекомендаций оформляется как _Технологический радар_.

_Что это значит конкретно для тебя?_

1. Нужно четко понимать, где найти последнюю версию корпоративных регламентов (например, Технологический радар)
1. Предстоит заниматься самопроверкой - проверять свои инженерные решения по архитектуре системы на соответствие этим регламентам.

_Что дальше?_
Как ты думаешь, могут ли требования к системе "мешать" друг другу? Например, реализация одного свойства системы потребует пожертвовать другим?
